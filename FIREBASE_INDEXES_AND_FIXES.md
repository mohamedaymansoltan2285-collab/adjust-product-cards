# ุฅุตูุงุญุงุช Firebase ูุงูููุงุฑุณ ุงููุทููุจุฉ

## โ ุงูููุงุฑุณ ุงููุทููุจุฉ (Required Indexes)

ุงูุณุฎ ูุฐู ุงูุฑูุงุจุท ูุงูุชุญูุง ูู ูุชุตูุญู ูุฅูุดุงุก ุงูููุงุฑุณ ุชููุงุฆูุงู:

### 1. Products - isActive + createdAt
https://console.firebase.google.com/v1/r/project/seven-blue-6278c/firestore/indexes?create_composite=ClFwcm9qZWN0cy9zZXZlbi1ibHVlLTYyNzhjL2RhdGFiYXNlcy8oZGVmYXVsdCkvY29sbGVjdGlvbkdyb3Vwcy9wcm9kdWN0cy9pbmRleGVzL18QARoMCghpc0FjdGl2ZRABGg0KCWNyZWF0ZWRBdBACGgwKCF9fbmFtZV9fEAI

### 2. Products - isActive + quantity (ููููุชุฌุงุช ุงูููุชุฑุญุฉ)
\`\`\`
Collection: products
Fields: 
  - isActive (Ascending)
  - quantity (Ascending)
\`\`\`

### 3. Users - referralCode (โญ IMPORTANT ููุธุงู ุงูุฅุญุงูุงุช)
\`\`\`
Collection: users
Fields: referralCode (Ascending)
\`\`\`
**ูุฐุง ุงูููุฑุณ ุถุฑูุฑู ุฌุฏุงู ูุนูู ูุธุงู ุงูุฅุญุงูุงุช!**

### 4. Notifications - userId + createdAt
\`\`\`
Collection: notifications
Fields: 
  - userId (Ascending)
  - createdAt (Descending)
\`\`\`

### 5. PointTransactions - userId + createdAt
\`\`\`
Collection: pointTransactions
Fields: 
  - userId (Ascending)
  - createdAt (Descending)
\`\`\`

### 6. Referrals - referrerId + createdAt
\`\`\`
Collection: referrals
Fields: 
  - referrerId (Ascending)
  - createdAt (Descending)
\`\`\`

### 7. Redemptions - userId + createdAt
\`\`\`
Collection: redemptions
Fields: 
  - userId (Ascending)
  - createdAt (Descending)
\`\`\`

### 8. Users - loyalty.referralCount (ูููุญูููู ุงูุฃูุถู)
\`\`\`
Collection: users
Fields: 
  - loyalty.referralCount (Descending)
\`\`\`

## โ ุงูุชุบููุฑุงุช ุงูุฃุณุงุณูุฉ

### 1. ููู referralCode ุฅูู ุงููุณุชูู ุงูุฃูู
**ุงูุณุงุจู**: `loyalty.referralCode`
**ุงูุฌุฏูุฏ**: `referralCode` (ุญูู ูููุตู ูุจุงุดุฑุฉ ูู document)

ูุฐุง ุงูุชุบููุฑ ูุณูุญ ุจุฅูุดุงุก ุงุณุชุนูุงู ุจุณูุท ุจุฏูู ุงูุญุงุฌุฉ ูููุฑุณ ูุนูุฏ.

### 2. ุชุจุณูุท ููุงุนุฏ ุงูุฃูุงู
ุชู ุชุจุณูุท ุงูููุงุนุฏ ูุชููู ุฃูุซุฑ ูุถูุญุงู ูุฃูุงูุงู ูุน ุงูุญูุงุธ ุนูู ุงููุธุงุฆู ุงููุทููุจุฉ.

### 3. ุฅุถุงูุฉ ููุชุฌุงุช ููุชุฑุญุฉ
ุชู ุฅุถุงูุฉ ูุณู ููุชุฌุงุช ููุชุฑุญุฉ ูู ุตูุญุฉ ุงูุณูุฉ ูุงูููุถูุฉ ูุน ุงุณุชุนูุงู ูุญุณูู.

## ๐ง ุฎุทูุงุช ุงูุชูููุฐ ูู ุฌุงูุจู

### ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุงูููุงุฑุณ
ุงูุชูู ุฅูู Firebase Console > Firestore Database > Indexes ูุฃูุดุฆ ุงูููุงุฑุณ ุงูุชุงููุฉ:

1. ุงูุชุญ ุฑุงุจุท ุงูููุฑุณ ุงูุฃูู ุฃุนูุงู ูุฅูุดุงุก `products` index ุชููุงุฆูุงู
2. ุฃูุดุฆ ุจุงูู ุงูููุงุฑุณ ูุฏููุงู ูู ูุณู Indexes ูู Firebase Console

### ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ููุงุนุฏ ุงูุฃูุงู
1. ุงูุชุญ ููู `firebase-rules-fixed.txt`
2. ุงูุณุฎ ูุญุชูุงู ุจุงููุงูู
3. ุงุฐูุจ ุฅูู Firebase Console > Firestore Database > Rules
4. ุงุณุชุจุฏู ุงูููุงุนุฏ ุงูุญุงููุฉ ุจุงูููุงุนุฏ ุงูุฌุฏูุฏุฉ
5. ุงุถุบุท ุนูู Publish

### ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุนูู ุงููุธุงู
ุจุนุฏ ุชุทุจูู ุงูุชุบููุฑุงุช ุฃุนูุงู:
1. ุณุฌู ุงูุฏุฎูู ููุณุชุฎุฏู
2. ุงูุณุฎ ุฑุงุจุท ุงูุฅุญุงูุฉ ูู ุตูุญุฉ ุงูุจุฑููุงูู
3. ุงูุชุญ ุงูุฑุงุจุท ูู ูุงูุฐุฉ ูุชุตูุญ ุฌุฏูุฏุฉ (ูุถุน ุงูุชุตูุญ ุงูุฎูู)
4. ุฃูุดุฆ ุญุณุงุจ ุฌุฏูุฏ
5. ุชุฃูุฏ ูู:
   - ุธููุฑ ุงุณู ุงูููุญูู ุนูุฏ ูุชุญ ุงูุฑุงุจุท
   - ุญุตูู ุงูููุญูู ุนูู 3 ููุงุท ุจุนุฏ ุฅูุดุงุก ุงูุญุณุงุจ
   - ุธููุฑ ุงูุฅุญุงูุฉ ูู ุณุฌู ุงูุฅุญุงูุงุช
   - ุฅุฑุณุงู ุฅุดุนุงุฑ ููููุญูู

## ๐ ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

- โ ูุดููุฉ ุงูููุฑุณ ุงูููููุฏ: ุชู ุชุจุณูุท ุงูุงุณุชุนูุงู ุจููู referralCode ูููุณุชูู ุงูุฃูู
- โ ุนุฏู ุฅุฑุณุงู ุงูุฅุญุงูุงุช: ุชู ุฅุตูุงุญ ุงูุจุญุซ ุนู ุงูููุญูู ุจุงุณุชุฎุฏุงู referralCode
- โ ุนุฏู ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช: ุชู ุฅุตูุงุญ ููุงุนุฏ ุงูุฃูุงู ูุฅุถุงูุฉ ุงูููุงุฑุณ
- โ ุนุฏู ุธููุฑ ุงูููุชุฌุงุช ุงูููุชุฑุญุฉ: ุชู ุฅุถุงูุฉ ูุณู ููุชุฌุงุช ููุชุฑุญุฉ ูู ุงูุณูุฉ ูุงูููุถูุฉ
- โ ูุดููุฉ ุงูุชุตุฏูุฑ ูู ProductCard: ุชู ุฅุตูุงุญ ุงูุงุณุชูุฑุงุฏ ููููู named import

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ูุธุงู ุงูุฅุญุงูุงุช ูู ูุนูู** ุญุชู ุชูุดุฆ ููุฑุณ `users.referralCode`
2. ููููู ุงุฎุชุจุงุฑ ุงููุธุงู ููุฑุงู ุจุนุฏ ุฅูุดุงุก ุงูููุงุฑุณ (ูุฏ ูุณุชุบุฑู ุฏูููุชูู)
3. ุชุฃูุฏ ูู ูุณุฎ ููุงุนุฏ ุงูุฃูุงู ูู `firebase-rules-fixed.txt` ูููุณ ูู ุฃู ููู ุขุฎุฑ

## ๐ ุฑุณุงุฆู Console ุงููููุฏุฉ

ุนูุฏ ุงุฎุชุจุงุฑ ูุธุงู ุงูุฅุญุงูุงุชุ ุณุชุฌุฏ ุฑุณุงุฆู console ููุตูุฉ:
- `[v0] Searching for referral code:` - ุงูุจุญุซ ุนู ููุฏ ุงูุฅุญุงูุฉ
- `[v0] โ Found user with referral code:` - ุชู ุงูุนุซูุฑ ุนูู ุงูููุญูู
- `[v0] โ Referral processed successfully:` - ุชูุช ูุนุงูุฌุฉ ุงูุฅุญุงูุฉ ุจูุฌุงุญ
- `[v0] โ No user found with referral code:` - ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูููุญูู

ุฅุฐุง ุฑุฃูุช ุฑุณุงูุฉ ุฎุทุฃ ุชุญุชูู ุนูู "index" ุฃู "failed-precondition"ุ ููุฐุง ูุนูู ุฃู ุงูููุฑุณ ุงููุทููุจ ุบูุฑ ููุฌูุฏ.
